#pyLightpack
_Описание класса-обёртки для языка Python, который сильно упрощает работу с API Лайтпака_

##Введение
pyLightpack — это набор определений и методов для языка [Python](http://ru.wikipedia.org/wiki/Python), которые сильно упрощают процесс взаимодействия с API и написание плагинов для Лайтпака. Например, код простейшего скрипта, который будет плавно включать и гасить ярко-зелёную подсветку может выглядеть так:

```python
import lightpack, time # Подключаем необходимые внешние модули

lpack = lightpack.lightpack('127.0.0.1', 3636, [2,3,6,7,8,9,10,4,5,1], 'IDDQD') #Создаём объект и настраиваем его
lpack.connect() # Подключаемся к серверу API
lpack.lock() # Передаём управление от софта в скрипт
lpack.setSmooth(100) # Устанавливаем необходимую степень плавности смены цветов

while True :
  lpack.setColorToAll(0,255,0) # Яркость зелёного канала всех светодидов на максимум
  time.sleep(1) # Ждём секунду
  lpack.setColorToAll(0,0,0) # Выключаем все каналы всех светодиодов
  time.sleep(1)
```

"Живьём" этот и [некоторые другие](http://code.google.com/p/lightpack/source/browse/Software/apiexamples/Animexamples.py) выполненные на скорую руку эффекты выглядят так:

[<img src="http://img.youtube.com/vi/yUoRsVsyFEo/0.jpg">](http://www.youtube.com/watch?feature=player_embedded&v=yUoRsVsyFEo)

Этот документ содержит описание методов и некоторые примеры работы с ними. Для начала работы, неплохо было бы кратко ознакомиться с возможностями [API](http://code.google.com/p/lightpack/wiki/API), установить [Python 2.7](http://www.python.org/download/), положить файл [lightpack.py](http://code.google.com/p/lightpack/source/browse/Software/apiexamples/pyLightpack/lightpack.py) в одну папку с вашим будущим скриптом-плагином. Если Python для вас в новинку, то есть смысл держать под рукой один из [справочников-туториалов](http://wiki.python.org/moin/BeginnersGuide). Этот язык крайне гибок, но некоторые синтаксические конструкции могут казаться на первый взгляд неочевидными.

Если читать справку лень, а запустить скрипт хочется, то для совсем быстрого старта помимо вышеописанных рекомендаций нужно проделать следующее:

1. После установки Питона проследить за тем, чтобы файлы .py были ассоциированы с интерпретатором (происходит по умолчанию)
2. Запустить управляющий софт Лайтпака свежих версий, которые поддерживают API
3. Для Win выполнить **run—>cmd** запустив тем самым консоль
4. Посредством команд `/cd` (или любых удобных вам) перебраться в рабочую папку скрипта в которой обязательно должен находиться **lightpack.py**, как написано выше
5. Выполнить `/moi_script.py`

Не забывайте, что прервать выполнение Python-программы в любой момент из консоли можно посредством сочетания клавиш **Ctrl+C**. В примерах часто используются бесконечные циклы, так что это сочетание вам может пригодиться.

##Структура Python-скрипта
Из примера выше можно понять, что базовая структура скрипта выглядит следующим образом:

```
< Подключение внешних модулей >
< Создание объекта lightpack.lightpack() и его настройка >
< connect() >
< lock() >
...
< Основное тело скрипта >
...
< unlock() или disconnect() >
```

При этом у вас остаётся возможность использовать всю мощь и гибкость Питона вкупе с бездной внешних модулей для него. При этом плагины существуют параллельно с режимами управляющего софта Лайтпака (см. метод **lock()**) и не исключают друг друга. В нашем репозитории некоторые примеры плагинов с использованием pyLightpack находятся в [соответствующей папке](http://code.google.com/p/lightpack/source/browse/Software/apiexamples/).

Если по каким-то причинам Python вас не устраивает, вы можете работать напрямую с ["низкоуровневым" API](http://code.google.com/p/lightpack/wiki/API), или даже написать собственную обёртку (wrapper) под любимый язык. Если так, то не забудьте поделиться ей с нами.)

##Базовые методы
Описание основных методов необходимых для подключения к API и управления приоритетами.
###lightpack.lightpack()
_Аргументы: **host, port, ledMap, APIkey**_

Конструктор, который создаёт объект. В качестве аргументов передаются настройки. **host** — адрес машины на которой запущен управляющий софт Лайтпака. В случае если машина та же, на которой вы запускаете скрипт, то нужно указать **127.0.0.1** или **localhost**. **port** — адрес TCP-порта который слушает сервер (по умолчанию **3636**). **ledMap** — массив для ремаппинга вашей светодиодной конфигурации.

Не секрет, что при установке Лайтпака все пользователи используют разную конфигурацию светодиодов. Кто-то подсвечивает только боковые грани монитора, кто-то весь периметр. Кто-то использует 8 светодиодов, кто-то 10, а некоторые и вовсе светодиодные ленты. При этом светодиоды располагаются в произвольном порядке. Поэтому после настройки управляющего софта виджеты захвата в нём стоят не по порядку. И для установки цвета на конкретный светодиод из API вам нужно знать его номер (открыть настройки и посмотреть на номер виджета соответствующего нужному светодиоду). Именно для устранения этого неудобства мы ввели массив ремаппинга.

Для того чтобы правильно заполнить этот массив, нужно сделать следующее:

1. Открыть настройки программы захвата
2. Выбрать начальный (стартовый) светодиод (например, левый нижний угол)
3. Проставить все номера виджетов в массив по порядку начиная со стартового и дальше по часовой стрелке

Теперь, когда вы будете устанавливать цвета через API вам нужно будет просто помнить положение стартового светодиода, к которому вы сможете обращаться как к первому, следующий за ним по часовой стрелке будет вторым и т.д.

**APIkey** — ключ авторизации для API-сервера. Его можно сгенерировать или отредактировать в соответствующем разделе программы захвата. Ключ нужен для простейшей защиты от несанкционированного использования API через сеть. Тем не менее, в программе есть возможность отключить авторизацию внешних скриптов и плагинов. В этом случае аргумент в конструкторе можно просто опустить.

`lpack = lightpack.lightpack('127.0.0.1', 3636, [2,3,6,7,8,9,10,4,5,1], 'mySecureAPIkey')`