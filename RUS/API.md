# API

* [help](#help)
* [exit](#exit)
 * [Авторизация подключения](#авторизация-подключения)
* [apikey](#apikey)
 * [GET-команды](#GET-команды)
* [getstatus](#getstatus)
* [getstatusapi](#getstatusapi)
* [getprofiles](#getprofiles)
* [getprofile](#getprofile)
* [getcountled](#getcountled)
  * [SET-команды](#SET-команды)
* [lock](#lock)
* [unlock](#unlock)
* [setcolor](#setcolor)
* [setgamma](#setgamma)
* [setsmooth](#setsmooth)
* [setbrightness](#setbrightness)
* [setprofile](#setprofile)
* [setstatus](#setstatus)

Документ описывает "низкоуровневый" API (документация актуальна для версии API 1.3), который позволяет управлять устройством из внешних программ и плагинов через механизм сокетов. Фактически, из любой ОС, вы можете подключиться через терминал и посылать устройству команды в режиме реального времени.

<pre>
>> telnet 127.0.0.1 3636
<< Lightpack API v1.3 (type "help" for more info)
</pre>

На практике для написания плагинов это не очень удобно из-за того, что постоянно приходится контролировать посылки в порт и ответы сервера. Поэтому мы создали специальный класс-обёртку для языка Python, которая называется pyLightpack. С его помощью вы изолируете себя от работы с сокетами и сможете сосредоточиться непосредственно на плагинах. Писать управляющие Лайтпаком скрипты с её помощью проще, чем настраивать конфиг для Quake.)

Однако, для точного понимания того, как именно функционирует API мы приводим здесь полный список команд с которыми он взаимодействует. Технически это взаимодействие реализуется через сервер, который при старте усправляющего софта Лайтпака открывает и "слушает" порт 3636 (по умолчанию).

## help

<pre>
>> help
</pre>

Команда выводит самую актуальную справку по текущей версии API и доступна постоянно.

## exit

<pre>
>> exit
<< Goodbye!
</pre>

Команда закрывает подключение к серверу и доступна постоянно.

# Авторизация подключения

Начиная с версии 1.1 API поддерживает авторизацию внешних подключений. Это простейший путь защиты от несанкционированных подключений к устройству извне. Он предполагает посылку ключа авторизации, который известен лишь серверу. Вы всегда можете сгенерировать новый ключ авторизации, или вовсе отключить её в настройках программы захвата Лайтпака. Если авторизация включена, то единственный способ пройти её и получить доступ к остальным командам это команда

## apikey

*Возвращаемые значения*: *ok или fail*

Отправляет серверу строку ключа авторизации. Если строка совпадает с заданной в программе, сервер авторизует подключение и у пользователя появляется доступ ко всем командам API.

<pre>
>> apikey:{209e6248-b0d4-4757-a355-9593ee34f700}
<< fail
>> apikey:IDDQD
<< ok
</pre>

# GET-команды

Работают при любых настройках подключения, даже в том случае когда управление устройством не передано API

## getstatus

*Возвращаемые значения: on, off, device error или unknown*

Возвращает состояние устройства, которое, будучи подключенным к ПК может быть выключено (светодиоды не горят), или включено в настройках программы захвата. Команда возвращает device error в случае ошибки доступа к устройству (иконка в трее меняется на запрещающую). Unknown -- маловероятное событие, которое происходит при истечении таймаута запроса к GUI (~1 с.)

<pre>
>> getstatus
<< status:on
</pre>

## getstatusapi

*Возвращаемые зачения: idle или busy*

Возвращает текущее состояние API устройства. API занят в том случае, если управление устройством осуществляется извне (вами, вашим скриптом, кем-то по сети и пр.) и свободен если устройством управляет программа захвата. До тех пор пока не будет выполнена команда lock (см. ниже) API не может быть занят.

<pre>
>> getstatusapi
<< statusapi:idle
</pre>

## getprofiles

Возвращает полный список профилей настроек управляющей программы через ; . Профили хранятся в папке Profiles.
<pre>
>> getprofiles
<< profiles:Lightpack;test07;New profile 1;
</pre>

## getprofile

Возвращает имя текущего активного профиля.
<pre>
>> getprofile
<< profile:test07
</pre>

## getcountleds

Начиная с версии 5.8 управляющей программы у пользователя появилась возможность управлять с её помощью разными устройствами. Для некоторых из них пользователь может самостоятельно выбирать количество зон захвата от 1 до 50 по количеству используемых светодиодов.

Команда возвращает общее количество всех зон захвата (активных и отключенных) в текущем профиле.

<pre>
>> getcountleds
<< countleds:10
</pre>

# SET-команды

Могут быть выполнены в том случае, когда контроль над устройством передан API посредством команды lock

## lock
*Возвращаемые значения: success или busy*

Передаёт контроль над устройством от программы захвата вашему внешнему скрипту. До тех пор пока не выполнена эта команда, через API могут выполняться лишь GET-команды.

<pre>
>> lock
<< lock:success
</pre>

## unlock

*Возвращаемые значения: success или not locked*

По аналогии с предыдущей командой передаёт управление от вашего скрипта обратно программе Лайтпака. Все настройки берутся из текущего профиля. Именно благодаря этому простейшему механизму передачи приоритета становится возможным полноценно использовать все фичи основной программы захвата в ваших скриптах.

<pre>
>> unlock
<< unlock:not locked
</pre>

## setcolor

*Синтаксис: setcolor:N-R,G,B*

*Возвращаемые значения: ok, error, busy или not locked*

Здесь и далее в set-командах ответ busy означает, что API уже "залочен" другим скриптом, пользователем через сеть и пр. См. команду lock.

Основная команда для установки цвета. N -- номер светодиода (совпадает с номером его зоны захвата). R,G,B -- значение яркости каждого канала указанного светодиода устанавливается числом от 0 до 255. Так же этой командой можно установить цвета на несколько или все светодиоды одновременно. Для каждого из них конструкцию N-R,G,B нужно указывать через ;

<pre>
>> setcolor:1-0,255,0;5-255,200,30;
<< ok
</pre>

## setgamma

*Синтаксис: setgamma:N*

*Возвращаемые значения: ok, error, busy или not locked*

Устанавливает уровень гамма-коррекции для устройства в диапазоне от 0.01 до 10.00 .

<pre>
>> setgamma:2.15
<< ok
</pre>

## setsmooth

*Синтаксис: setsmooth:N*

*Возвращаемые значения: ok, error, busy или not locked*

Устанавливает степень плавности смены цветов для устройства в диапазоне от 0 (плавность отключена) до 255 .

<pre>
>> setsmooth:100
<< ok
</pre>

## setbrightness

*Синтаксис: setbrightness:N*

*Возвращаемые значения: ok, error, busy или not locked*

Устанавливает степень яркости для всех светодиодов устройства одновременно в диапазоне от 0 (подсветка выключена) до 100 .

<pre>
>> setbrightness:80
<< ok
</pre>

## setprofile

*Синтаксис: setprofile:<name>*

*Возвращаемые значения: ok, error, busy или not locked*

Включает заданный профиль настроек. Список профилей доступен по команде getprofiles (см. выше).

<pre>
>> setprofile:My HD video
<< ok
</pre>

## setstatus

*Возможные параметры: on или off*

*Возвращаемые значения: ok, error, busy или not locked*

Включает и выключает устройство. Аналог кнопки "вкл/выкл подсветку" в настройках программы.

<pre>
>> setstatus:off
<< ok
</pre>
